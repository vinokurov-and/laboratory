### Автоматическое тестирование и защита ветки main через GitHub Actions

##  Часть 1: Добавь тест к компоненту Counter.jsx

1. Открой проект в редакторе (например, VS Code)
2. Создай новый файл Counter.jsx
```
src/components/Counter.jsx
```
3. Скопируй в него всю логику счёта из App.jsx — но без img, h1, p и стилей:
```
import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return (
    <div className="card">
      <button onClick={() => setCount((count) => count + 1)}>
        count is {count}
      </button>
      <p>
        Edit <code>src/components/Counter.jsx</code> and save to test HMR
      </p>
    </div>
  )
}
```

- Убери import reactLogo, viteLogo — они не нужны здесь.
- Оставь только кнопку и счётчик.
- className="card" — оставь, чтобы сохранить стили.


4. Упрости App.jsx
```
import Counter from './components/Counter'
import './App.css'

function App() {
  return (
    <>
      <div>
        <a href="https://vite.dev" target="_blank">
          <img src="/vite.svg" className="logo" alt="Vite logo" />
        </a>
        <a href="https://react.dev" target="_blank">
          <img src="/react.svg" className="logo react" alt="React logo" />
        </a>
      </div>
      <h1>Vite + React</h1>
      <Counter /> {/* ← Теперь здесь только компонент */}
      <p className="read-the-docs">
        Click on the Vite and React logos to learn more
      </p>
    </>
  )
}

export default App
```

4. Запусти проект и проверь
```
npm run dev
```

Убедись, что:
- Логотипы отображаются
- Заголовок есть
- Кнопка работает — счётчик увеличивается
- Стили (card, logo) остались теми же
✅ Это — рефакторинг.
- Ты ничего не сломал — ты улучшил структуру.


## Часть 2: Настройка тестирования с Vitest

Если ваш проект Vite + React + TypeScript еще не настроен для тестирования, выполните следующие шаги в корневой директории вашего проекта (`lab1-react-vite-gh-pages`).

1.  **Установите Vitest и @testing-library:**
    Откройте терминал в корне вашего проекта и установите Vitest, `@testing-library/react` и сопутствующие пакеты:
    ```bash
    npm install -D vitest @vitest/coverage-v8 jsdom @testing-library/react @testing-library/jest-dom
    ```
    *   `vitest`: Фреймворк для тестирования.
    *   `@vitest/coverage-v8`: Для генерации отчетов по покрытию кода (опционально, но полезно).
    *   `jsdom`: Эмуляция DOM-окружения для тестирования компонентов React.
    *   `@testing-library/react`: Утилиты для тестирования React-компонентов.
    *   `@testing-library/jest-dom`: Расширяет возможности `expect` для более удобных проверок DOM.

2.  **Настройте `package.json`:**
    Откройте файл `package.json` и добавьте или обновите раздел `"scripts"`, а также убедитесь, что в `"devDependencies"` присутствуют установленные пакеты с актуальными версиями:

    ```json
    {
      // ... другие поля
      "scripts": {
        "dev": "vite",
        "build": "tsc -b && vite build",
        "preview": "vite preview",
        "predeploy": "npm run build",
        "deploy": "gh-pages -d dist",
        "test": "vitest",             // Добавляем скрипт для запуска тестов
        "coverage": "vitest run --coverage" // Опционально: скрипт для отчета покрытия кода
      },
      // ... другие поля
      "devDependencies": {
        // ... существующие devDependencies из Лабы 1
        "vitest": "^1.x.x", // Убедитесь, что версия соответствует установленной
        "@vitest/coverage-v8": "^1.x.x",
        "jsdom": "^24.x.x",
        "@testing-library/react": "^14.x.x",
        "@testing-library/jest-dom": "^6.x.x",
        // ...
      }
    }
    ```

   3.  **Создайте или обнови `vite.config.ts` для Vitest:**
    Откройте файл `vite.config.ts` в корне проекта и добавьте секцию `test` для конфигурации Vitest.

    ```typescript
    import { defineConfig } from 'vite'
    import react from '@vitejs/plugin-react'
    import { UserConfig } from 'vitest/config'; 

    export default defineConfig({
      plugins: [react()],
      base: '/lab1-react-vite-gh-pages', // Из Лабораторной работы 1
      test: { // Конфигурация для Vitest
        globals: true, // Позволяет использовать глобальные переменные (test, expect и т.д.) без явного импорта
        environment: 'jsdom', // Использует JSDOM для эмуляции браузерного окружения
        setupFiles: './src/setupTests.ts', // Файл для глобальных настроек тестов
        css: true, // Включает обработку CSS в тестах (если ваши компоненты зависят от стилей)
      } as UserConfig, // Явно указываем тип для корректной работы с Vitest
    });
    ```

    4.  **Создайте файл `src/setupTests.ts`:**
    Этот файл будет содержать глобальные настройки для ваших тестов, в частности, импорт расширений `jest-dom`.
    Создайте файл `src/setupTests.ts` со следующим содержимым:
    ```typescript
    import '@testing-library/jest-dom'; // Импортируем расширения для expect
    ```

    5.  **Напишите простой тест для компонента `App.tsx`:**
    Создайте файл `src/App.test.tsx` (или `src/__tests__/App.test.tsx`) со следующим содержимым. Этот тест будет проверять, что логотипы Vite и React присутствуют в компоненте `App`.

    ```typescript
    import { render, screen } from '@testing-library/react';
    import { expect, test } from 'vitest';
    import App from './App'; 

    test('renders Vite and React logos', () => {
      render(<App />);

      // Предполагаем, что в вашем App.tsx есть изображения с alt-текстами "Vite logo" и "React logo"
      // Если ваш App.tsx сильно отличается от дефолтного, возможно, нужно будет изменить эти селекторы.
      const viteLogoElement = screen.getByAltText('Vite logo');
      const reactLogoElement = screen.getByAltText('React logo');

      expect(viteLogoElement).toBeInTheDocument();
      expect(reactLogoElement).toBeInTheDocument();
    });

    // Дополнительный тест, если в App.tsx есть текст "Vite + React"
    test('renders "Vite + React" heading', () => {
      render(<App />);
      const headingElement = screen.getByText(/Vite \+ React/i); // Поиск текста с учетом регистра
      expect(headingElement).toBeInTheDocument();
    });
    ```

    6.  **Запусти тесты локально:**
    В терминале выполните:
    ```bash
    npm run test
    ```
    Убедитесь, что все тесты проходят без ошибок.

    7. Написать тесты на Counter.jsx

    8. Запустить локально тесты

## Часть 2: Настройка GitHub Actions для тестирования

Теперь, когда тесты работают локально, настроим их запуск на GitHub при каждом push-запросе.

1.  **Создайте директорию `.github/workflows`:**
    В корне вашего проекта создайте папку `.github`, а внутри нее - папку `workflows`.
    ```bash
    mkdir -p .github/workflows
    ```

2.  **Создайте файл workflow:**
    Внутри папки `.github/workflows` создайте файл с именем, например, `ci.yml` (или `test.yml`), и добавьте следующее содержимое:
    ```yaml
    name: CI/CD Pipeline

    on:
      push:
        branches:
          - main # Запускать workflow при пуше в ветку main
      pull_request:
        branches:
          - main # Запускать workflow при создании/обновлении pull request в ветку main

    jobs:
      test:
        name: Run Tests
        runs-on: ubuntu-latest # Используем последнюю версию Ubuntu для выполнения задания

        steps:
          - name: Checkout code
            uses: actions/checkout@v4 # Скачиваем ваш код из репозитория на runner

          - name: Set up Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '20' # Используем Node.js версии 20 (или выше, как указано в Лабе 1)
              cache: 'npm'       # Кэшируем зависимости npm для ускорения установки

          - name: Install dependencies
            run: npm install # Устанавливаем все зависимости проекта

          - name: Run Vitest tests
            run: npm run test # Запускаем ваши тесты Vitest
            # Если тесты не проходят, этот шаг завершится ошибкой, и весь workflow будет считаться проваленным.

      deploy:
        name: Deploy to GitHub Pages
        needs: test # Этот job зависит от успешного выполнения job 'test'. Деплой не начнется, если тесты провалились.
        if: success() && github.ref == 'refs/heads/main' # Деплоить только если тесты прошли и это ветка main
        runs-on: ubuntu-latest

        steps:
          - name: Checkout code
            uses: actions/checkout@v4

          - name: Set up Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '20'
              cache: 'npm'

          - name: Install dependencies
            run: npm install

          - name: Build project
            run: npm run build # Собираем проект для деплоя

          - name: Deploy to GitHub Pages
            run: npm run deploy # Запускаем скрипт деплоя gh-pages
            env:
              GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Используем встроенный токен GitHub для аутентификации
                                                    # gh-pages обычно использует этот токен по умолчанию.
    ```

3. Отправить изменения на github

